<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C" /><title> 用python分析了wh的药店 · 静思地</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="python数据分析，武汉全部的药店数据"><meta name="keywords" content="数据分析 python 药店"><meta name="author" content="Lin Free"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.fbi.st/atom.xml" title="静思地"></head><body><header><div class="header row"> <a href="http://fbi.st/" class="logo-link"><img src="/images/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/categories/live/" target="_self" data-hover="生活" class="nav-list-link">生活</a></li><li class="nav-list-item"><a href="/categories/read/" target="_self" data-hover="读书" class="nav-list-link">读书</a></li><li class="nav-list-item"><a href="/about/" target="_self" data-hover="关于" class="nav-list-link">关于</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">用python分析了wh的药店</h1><div class="post-info">2017-10-20 20:13</div><div class="post-content"><h2 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h2><p>其实打算分析药店这个事情，与看完《我不是药神》没啥关系，取这个标题，只是为了蹭一波电影的热度。<br>主要起因是，在世界杯期间看到一条段子：  </p>
<blockquote>
<p>美国500米就有一个篮球场，巴西每个小区一个足球场，而中国500米就有个大药房。  </p>
</blockquote>
<p>开始只是当成一个段子，觉得有夸张的嫌疑。但某天逛完超市回家，刻意的数了一下药店数量。  </p>
<p><strong> 震惊! 不到1km的路上居然有6，7个药店！真可怕。 </strong>   </p>
<p>正好我最近刚开始学习python数据分析，于是，就决心以“超一线城市大武汉”为例，好好看看中国的药店到底多不多。  </p>
<h2 id="数据获取"><a href="#数据获取" class="headerlink" title="数据获取"></a>数据获取</h2><h3 id="通过地图WebAPI"><a href="#通过地图WebAPI" class="headerlink" title="通过地图WebAPI"></a>通过地图WebAPI</h3><p>我尝试着找了一下，好像网上没有现成的数据。<br>只能自己动手，搞点数据了。  </p>
<p>首先想到的是通过百度地图来获取数据，找了找，果然有相关的WebAPI。  </p>
<blockquote>
<p>地点检索服务（又名Place API）是一类Web API接口服务；<br>服务提供多种场景的地点（POI）检索功能，包括城市检索、圆形区域检索、矩形区域检索。开发者可通过接口获取地点（POI）基础或详细地理信息。    </p>
</blockquote>
<p>能直接通过WebAPI获取数据，连解析页面都省了，简直太爽了有木有？</p>
<p>本以为可以直接通过城市的检索的接口直接获取到我想要的数据。<br>然鹅，我错了，事情没我想的那么简单，这个api居然最多返回400条数据。大武汉的药店明显不止400个。我试着找了一下高德，高德更抠门，就200个结果。只能想想其他办法了。</p>
<h3 id="切割地图"><a href="#切割地图" class="headerlink" title="切割地图"></a>切割地图</h3><p>继续找其他的解决办法，忽然发现了地点检索api后面还有一个矩形区域检索功能。灵机一动，我可以把大武汉分成很多个小矩形，分块检索啊，这样也不会有数据丢失。        </p>
<p>想法很好，可当我看到武汉这长得像块‘三鲜豆皮’的地图的时候，问题又来了，我该怎么切割这个地图。  </p>
<p><img src="https://i.loli.net/2018/07/30/5b5f15caa7de8.jpg" alt="wh_map.jpg">  </p>
<p>抱着不能错过一个，也不能浪费api资源的态度，我打算先找到武汉东南西北之最，也就是找到一个可以将武汉包裹的最小矩形。</p>
<p>想到了通过城市边界点筛选的方式获取武汉的最东，最南，最西，最北。结果找了半天没发现百度webapi里有这个，只有一个javascriptAPI有这个功能，比较麻烦。反倒是高德有个“行政区域查询”的api可以直接获取到城市边界。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://restapi.amap.com/v3/config/district?key=您的key&amp;keywords=武汉&amp;subdistrict=0&amp;extensions=all</div></pre></td></tr></table></figure></p>
<p>接下来的事情就简单了，分析获取到的城市边界点列表，找到经纬度的最大最小值，即城市的最东南西北。然后从东到西切20刀，从南到北均匀切20刀。武汉一下就被切成400块了。  </p>
<p>我们就可以分块的去调用地点检索的API，如果有超过400个的，就调整参数，多切几刀。  </p>
<p>当然，这样切肯定有误伤周边城市的情况。这种情况就通过POI的“city”属性去筛选掉。</p>
<p>至此，我们就成功的获取到了我们想要的比较完整的药店的数据了。</p>
<h3 id="其他数据"><a href="#其他数据" class="headerlink" title="其他数据"></a>其他数据</h3><p>有了药店的数据，我们还需要一些其他的数据，例如：行政区域面积啊，人口数量等。<br>像这类的数据，一般在当地的统计局网站都能下载到。 </p>
<h2 id="数据分析"><a href="#数据分析" class="headerlink" title="数据分析"></a>数据分析</h2><h3 id="药店位置分布"><a href="#药店位置分布" class="headerlink" title="药店位置分布"></a>药店位置分布</h3><p>我猜想，药店的数量应该与人口密度和地方经济情况有所关系。        </p>
<p>首先，我们通过图表看看武汉的人口密度：<br><img src="https://i.loli.net/2018/08/01/5b61bd5f1e4d0.png" alt="武汉人口密度.png"></p>
<p>从图像可以看出，人口密度最大的是江汉区，硚口区和武昌区，这些都是武汉的老城区。<br>黄陂区，江夏，汉南这些都算是郊区，人口密度低，也情有可原。<br>意外的是：主城区洪山区人口密度居然也不高。（可能统计面积的时候几个大湖也算进去了？）        </p>
<p>再看看，我们收集的药店的数据，我爬取的百度地图上能找到的武汉所有药店，一共爬到了1936个，估计还有一些没有收录到的遗漏了。在武汉药监局官网查到的药品零售企业有4317个，但这里可能又很多过期可但未注销的企业。所以这次我们以百度地图爬取到的数据为准。</p>
<p>首先我们看看各个区人数和药店数量的基本情况：<br><img src="https://i.loli.net/2018/08/02/5b631261e4971.png" alt="武汉各区人数和药店数.png">  </p>
<p>基本大多数的区药店数量都超过了1万人一个药店。     </p>
<p>再看看武汉每个区的药店数量情况，武汉各个区域药店的数量占比：<br><img src="https://i.loli.net/2018/08/02/5b62d5e88df71.png" alt="武汉药店各区域占比.png">   </p>
<p>武昌、江岸、洪山、江汉这几个主城区果然还是占了大多的数的药店。</p>
<p>药店密度和人口密度是否有关呢？<br><img src="https://i.loli.net/2018/08/01/5b61c3933b99d.png" alt="武汉各区多少人一个药店.png"></p>
<p>药店最密集的是江岸区，3408个人就有一个药店。而药店比较稀缺的新洲区居然平均26317个人才有一个药店，新洲区的朋友会不会有买药难的问题？</p>
<p>经济状况好的主城区人均药店数明显比郊区高。</p>
<p>光在表格上我们没办法形象的看到药店的分布，所以做成热力图更形象了。<br><img src="https://i.loli.net/2018/08/01/5b61c590c5ae0.png" alt="武汉药店热力分布图.png"></p>
<h3 id="药店店名分析"><a href="#药店店名分析" class="headerlink" title="药店店名分析"></a>药店店名分析</h3></div></article></div><div class="right-container"><div class="widget"><div class="category"><h4>分类归档</h4><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch非权威指南/">Elasticsearch非权威指南</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/bigdata/">bigdata</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/live/">live</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/read/">read</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">5</span></li></ul></div></div><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/Elasticsearch/" style="font-size: 17.5px;">Elasticsearch</a> <a href="/tags/HBase/" style="font-size: 12.5px;">HBase</a> <a href="/tags/Hadoop/" style="font-size: 12.5px;">Hadoop</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/Mysql/" style="font-size: 15px;">Mysql</a> <a href="/tags/PHP/" style="font-size: 10px;">PHP</a> <a href="/tags/Python/" style="font-size: 12.5px;">Python</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SSH/" style="font-size: 10px;">SSH</a> <a href="/tags/php/" style="font-size: 12.5px;">php</a> <a href="/tags/shell/" style="font-size: 10px;">shell</a> <a href="/tags/分页/" style="font-size: 10px;">分页</a> <a href="/tags/前端/" style="font-size: 10px;">前端</a> <a href="/tags/大数据/" style="font-size: 12.5px;">大数据</a> <a href="/tags/工具/" style="font-size: 10px;">工具</a> <a href="/tags/心情记录/" style="font-size: 10px;">心情记录</a> <a href="/tags/数据库/" style="font-size: 20px;">数据库</a> <a href="/tags/正则表达式/" style="font-size: 10px;">正则表达式</a> <a href="/tags/生活/" style="font-size: 12.5px;">生活</a> <a href="/tags/电影/" style="font-size: 12.5px;">电影</a> <a href="/tags/读书笔记/" style="font-size: 10px;">读书笔记</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/02/27/2018-应该静下来/">2018_应该静下来</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/22/《楚门的世界》，关于选择和自由/">《楚门的世界》，关于选择和自由</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/12/28/看电影《十二怒汉》/">看电影《十二怒汉》</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/20/《如何阅读一本书》读书笔记/">《如何阅读一本书》读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/10/20/看完《我不是药神》后我用python分析了中国的药店/">用python分析了wh的药店</a></li></ul></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2017/10/20/《如何阅读一本书》读书笔记/" class="prev">上一篇</a><a href="/2017/08/20/redis非权威指南(基本知识)/" class="next">下一篇</a></div><div id="lv-container" data-id="city" data-uid="MTAyMC80MDQ4MC8xNzAwNw=="></div><script type="text/javascript">(function(d, s) {
var j, e = d.getElementsByTagName(s)[0];
if (typeof LivereTower === 'function') { return; }
j = d.createElement(s);
j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
j.async = true;
e.parentNode.insertBefore(j, e);
})(document, 'script');</script><noscript> 为正常使用来必力评论功能请激活JavaScript</noscript><div class="copyright"><p>© 2017 - 2018 <a target="_blank">Lin Free</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/linfree/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a>.</p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>