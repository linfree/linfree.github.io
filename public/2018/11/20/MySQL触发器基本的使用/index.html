<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="1EB8XoOl0C"><title> MySQL触发器基本的使用 · 静思地</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="MySQL触发器基本的使用"><meta name="keywords" content="mysql 触发器 拓展"><meta name="author" content="Lin Free"><link rel="short icon" href="/images/favicon.ico"><link rel="stylesheet" href="/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.fbi.st/atom.xml" title="静思地"></head><body><header><div class="header row"> <a href="http://fbi.st/" class="logo-link"><img src="/images/logo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" data-hover="博文" class="nav-list-link">博文</a></li><li class="nav-list-item"><a href="/archives/" target="_self" data-hover="归档" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="/categories/live/" target="_self" data-hover="生活" class="nav-list-link">生活</a></li><li class="nav-list-item"><a href="/categories/read/" target="_self" data-hover="读书" class="nav-list-link">读书</a></li><li class="nav-list-item"><a href="/about/" target="_self" data-hover="关于" class="nav-list-link">关于</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">MySQL触发器基本的使用</h1><div class="post-info">2018-11-20 10:54</div><div class="post-content"><h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>触发器是一种特殊的<code>存储过程</code>，是嵌入到mysql的一段程序，它在插入，删除或修改特定表中的数据时触发执行。</p>
<h2 id="一、基本语法"><a href="#一、基本语法" class="headerlink" title="一、基本语法"></a>一、基本语法</h2><h3 id="1-创建触发器："><a href="#1-创建触发器：" class="headerlink" title="1. 创建触发器："></a>1. 创建触发器：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TRIGGER /*触发器名称*/</span><br><span class="line">AFTER / BEFORE /*(触发器工作的时机)*/ </span><br><span class="line">UPDATE / DELETE / INSERT /*(触发器监听事件)*/ </span><br><span class="line">ON /*表名(触发器监听的目标表)*/ </span><br><span class="line">FOR EACH ROW /*(行级监视，mysql固定写法，oracle不同)*/</span><br><span class="line">BEGIN</span><br><span class="line">	/*sql语句集........（触发器执行动作，分号结尾）*/</span><br><span class="line">END;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h3 id="2-删除触发器："><a href="#2-删除触发器：" class="headerlink" title="2. 删除触发器："></a>2. 删除触发器：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> <span class="keyword">IF</span> exist <span class="string">`trigger_name`</span>;</span><br></pre></td></tr></table></figure>
<h3 id="3-查询数据库触发器："><a href="#3-查询数据库触发器：" class="headerlink" title="3. 查询数据库触发器："></a>3. 查询数据库触发器：</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">triggers</span>;</span><br></pre></td></tr></table></figure>
<h3 id="4-触发器声明变量"><a href="#4-触发器声明变量" class="headerlink" title="4.触发器声明变量:"></a>4.触发器声明变量:</h3><p>一个变量名可以由当前字符集的数字字母字符和“<code>_</code>”、“<code>$</code>”和“<code>.</code>”组成;</p>
<h4 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h4><p>MySQL 中使用 <code>DECLARE</code> 来定义一局部变量，该变量只能在 <code>BEGIN … END</code> 复合语句中使用，并且应该定义在复合语句的开头，即其它语句之前。  </p>
<p>语法是：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> var_name[...]<span class="keyword">type</span>[<span class="keyword">DEFAULT</span> <span class="keyword">value</span>]</span><br></pre></td></tr></table></figure></p>
<p>其中，  </p>
<ul>
<li><code>var_name</code> 为变量名称，同sql语句一样，变量名不区分大小写;   </li>
<li><code>type</code> 为mysql支持的任何数据类型;   </li>
<li><code>DEFAULT</code> 子句提供默认值，值可以是一个表达式 (如果需要可以使用)。   </li>
</ul>
<blockquote>
<p>注: 可以同时定义多个同类型的变量，用逗号隔开，变量初始值为NULL；  </p>
</blockquote>
<p>例如：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> a <span class="built_in">INT</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DECLARE</span> b <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure></p>
<h4 id="用户变量"><a href="#用户变量" class="headerlink" title="用户变量"></a>用户变量</h4><p>用户变量：相当与全局变量。 只在一个数据库中有效<br>在客户端连接到数据库实例整个过程中用户变量都是有效的<br>mysql中用户变量<strong>不需要事先声明</strong>，在用的时候直接用<code>@变量名</code> 使用就可以<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*set语句可用于向系统变量或用户变量赋值*/</span></span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">num</span> = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SET</span> @<span class="keyword">num</span> := <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*也可使用select语句来定义*/</span></span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">num</span> := <span class="number">1</span>;</span><br><span class="line"><span class="keyword">SELECT</span> @<span class="keyword">num</span> := field_name <span class="keyword">FROM</span> table_name <span class="keyword">WHERE</span> <span class="number">1</span> = <span class="number">1</span>;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>注：SELECT只能用<code>:=</code> 定义 </p>
</blockquote>
<h3 id="5-变量的赋值"><a href="#5-变量的赋值" class="headerlink" title="5.变量的赋值"></a>5.变量的赋值</h3><p>mysql触发器内，对变量赋值采用 SET 语句<br>语法是：<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> var_name = expr [,var_name = expr] ...</span><br></pre></td></tr></table></figure></p>
<p>使用举例<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DECLARE</span> c <span class="built_in">INT</span>; </span><br><span class="line"><span class="keyword">SET</span> c = ( <span class="keyword">SELECT</span> stuCount <span class="keyword">FROM</span> <span class="keyword">class</span> <span class="keyword">WHERE</span> classID = new.classID );</span><br></pre></td></tr></table></figure></p>
<blockquote>
<h6 id="Tips"><a href="#Tips" class="headerlink" title="Tips:"></a>Tips:</h6><p><strong>行变量：</strong>当目标表发生改变时候，变化的行可用行变量表示<br><code>new</code> :代表目标表目标行发生改变之后的行<br><code>old</code> :代表目标表目标行发生改变之前的行  </p>
</blockquote>
<h3 id="6-逻辑判断语句"><a href="#6-逻辑判断语句" class="headerlink" title="6.逻辑判断语句"></a>6.逻辑判断语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IF <span class="comment">/*condition1*/</span> THEN</span><br><span class="line">　　　<span class="comment">/*do something;*/</span></span><br><span class="line">　ELSEIF <span class="comment">/*condition2*/</span> THEN</span><br><span class="line">　<span class="comment">/*do something;*/</span></span><br><span class="line"><span class="keyword">END</span> <span class="keyword">IF</span>;</span><br></pre></td></tr></table></figure>
<h2 id="二、示例"><a href="#二、示例" class="headerlink" title="二、示例"></a>二、示例</h2><h3 id="1-触发器监听：insert"><a href="#1-触发器监听：insert" class="headerlink" title="1.触发器监听：insert"></a>1.触发器监听：insert</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> <span class="string">`trigger_name`</span> </span><br><span class="line"><span class="keyword">AFTER</span> <span class="keyword">INSERT</span> </span><br><span class="line"><span class="keyword">ON</span> <span class="string">`table`</span> </span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="comment">/* 要做的SQL操作，如：</span></span><br><span class="line"><span class="comment">	UPDATE table1 SET field = 'abc' WHERE id = new.id;</span></span><br><span class="line"><span class="comment">	new 是行变量。</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h3 id="2-触发器监听：delete"><a href="#2-触发器监听：delete" class="headerlink" title="2.触发器监听：delete"></a>2.触发器监听：delete</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> <span class="string">`trigger_name2`</span> </span><br><span class="line"><span class="keyword">AFTER</span> <span class="keyword">DELETE</span> </span><br><span class="line"><span class="keyword">ON</span> <span class="string">`table`</span> </span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="comment">/* 要做的SQL操作，如：</span></span><br><span class="line"><span class="comment">	UPDATE table1 SET field = 'abc' WHERE id = old.id;</span></span><br><span class="line"><span class="comment">	old 是行变量。</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h3 id="3-触发器监听：update"><a href="#3-触发器监听：update" class="headerlink" title="3.触发器监听：update"></a>3.触发器监听：update</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> <span class="string">`trigger_name3`</span> </span><br><span class="line"><span class="keyword">AFTER</span> <span class="keyword">UPDATE</span> </span><br><span class="line"><span class="keyword">ON</span> <span class="string">`table`</span> </span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="comment">/* 要做的SQL操作，如：</span></span><br><span class="line"><span class="comment">	UPDATE table1 SET field = 'abc' WHERE id = new.id;</span></span><br><span class="line"><span class="comment">	old 是行变量。</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<h3 id="4-触发器SET和IF语句的综合使用"><a href="#4-触发器SET和IF语句的综合使用" class="headerlink" title="4.触发器SET和IF语句的综合使用"></a>4.触发器SET和IF语句的综合使用</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> <span class="string">`trigger_name4`</span> </span><br><span class="line"><span class="keyword">AFTER</span> <span class="keyword">UPDATE</span> </span><br><span class="line"><span class="keyword">ON</span> <span class="string">`table`</span> </span><br><span class="line"><span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> c <span class="built_in">INT</span>;</span><br><span class="line">	<span class="keyword">SET</span> c = <span class="number">1</span>;</span><br><span class="line">	IF c &lt; 1 THEN</span><br><span class="line">		<span class="keyword">SET</span> c = <span class="number">2</span>;</span><br><span class="line">	ELSEIF c &gt; 1 THEN</span><br><span class="line">	　<span class="keyword">SET</span> c = <span class="number">4</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">IF</span>;</span><br><span class="line">	<span class="comment">/* 要做的SQL操作，如：</span></span><br><span class="line"><span class="comment">	UPDATE table1 SET field = 'abc' WHERE id = new.id;</span></span><br><span class="line"><span class="comment">	old 是行变量。</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"><span class="keyword">END</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：<br><strong>①</strong>：for each row:必须填写，保证mysql支持行级控制，oracle同时支持行级控制和语句级控制。<br><strong>②</strong>：如果在BEFORE或AFTER触发程序的执行过程中出现错误，将导致调用触发程序的整个语句的失败。对于事务性表，如果触发程序失败（以及由此导致的整个语句的失败），该语句所执行的所有更改将回滚。对于非事务性表，不能执行这类回滚，因而，即使语句失败，失败之前所作的任何更改依然有效。  </p>
</blockquote>
</div></article></div><div class="right-container"><div class="widget"><div class="category"><h4>分类归档</h4><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Elasticsearch非权威指南/">Elasticsearch非权威指南</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/MySQL/">MySQL</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/leetcode/">leetcode</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/live/">live</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/read/">read</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tools/">tools</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据库/">数据库</a><span class="category-list-count">7</span></li></ul></div></div><div class="widget"><div class="tagcloud"><h4>标签云</h4><a href="/tags/Elasticsearch/" style="font-size: 20px;">Elasticsearch</a> <a href="/tags/Hadoop/" style="font-size: 12px;">Hadoop</a> <a href="/tags/Linux/" style="font-size: 14px;">Linux</a> <a href="/tags/MySQL/" style="font-size: 14px;">MySQL</a> <a href="/tags/Mysql/" style="font-size: 14px;">Mysql</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/leetcode/" style="font-size: 10px;">leetcode</a> <a href="/tags/php/" style="font-size: 18px;">php</a> <a href="/tags/python/" style="font-size: 16px;">python</a> <a href="/tags/tools/" style="font-size: 12px;">tools</a> <a href="/tags/数据库/" style="font-size: 16px;">数据库</a> <a href="/tags/生活/" style="font-size: 16px;">生活</a> <a href="/tags/电影/" style="font-size: 12px;">电影</a> <a href="/tags/读书笔记/" style="font-size: 10px;">读书笔记</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/07/19/elasticsearch常用查询整理/">elasticsearch常用查询整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/06/20/《如何阅读一本书》读书笔记/">《如何阅读一本书》读书笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/05/27/mysql通过触发器远程同步/">mysql通过触发器远程同步</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/20/leetcode算法题Z字形变换的解答/">leetcode算法题Z字形变换的解答</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/10/常用mysql命令笔记/">常用mysql命令笔记</a></li></ul></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/2018/12/09/elasticsearch_cat_api笔记/" class="prev">上一篇</a><a href="/2018/11/10/虚拟机装osx/" class="next">下一篇</a></div><div id="lv-container" data-id="city" data-uid="MTAyMC80MDQ4MC8xNzAwNw=="></div><script type="text/javascript">(function(d, s) {
var j, e = d.getElementsByTagName(s)[0];
if (typeof LivereTower === 'function') { return; }
j = d.createElement(s);
j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
j.async = true;
e.parentNode.insertBefore(j, e);
})(document, 'script');</script><noscript> 为正常使用来必力评论功能请激活JavaScript</noscript><div class="copyright"><p>© 2017 - 2019 <a target="_blank">Lin Free</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/linfree/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a>.</p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/scripts/jquery-1.8.2.min.js"></script><script src="/scripts/arAnchor.js"></script><script src="/scripts/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>