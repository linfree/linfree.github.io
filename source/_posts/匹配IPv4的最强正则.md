---
title: 匹配IPv4的最强正则
date: 2019-10-09 21:52:02
tags:
  - php
desc: 匹配IPv4的最强正则
keywords: php 正则 正则表达式 高级
categories:
- php

---

## 起因
技术群里的群友提出这样一个问题：

> php里面，能够有效匹配任意一个正常输入的ipv4地址，最短的正则表达式是什么？

<!--more-->
## 问题分析

1. ip地址范围是`0.0.0.0 - 255.255.255.255`  
2. 除非是0，不能以0开头  
3. 前面三个有点,末尾不能有点  

## 解决方案

虽然php有自己判断ip的函数，但问题是用正则表达式解决。

### 方案1(群友方案)  

简单的匹配  
```
\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}
```
存在问题：   
`999.999.999.999`都能匹配到。


### 方案2(群友方案) 

```re
^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$
```
存在问题：   
虽然数字范围限制在255以内，但是`001.1.1.1`也能匹配到。

### 方案三（我的方案）

```re
^(\d|[1-9][0-9]|1\d{2}|2[0-4]\d|25[0-5])(\.(\d|[1-9][0-9]|1\d{2}|2[0-4]\d|25[0-5])){3}$
```
存在问题：  
能满足所有的ip情况，但是不够优雅，简洁。算不上是最强。



## 最强ipv4表达式(之一吧)
```re
/^((2[0-4]|1\d|[1-9])?\d|25[0-5])(\.(?1)){3}\z/
```

简洁优雅。🐂！